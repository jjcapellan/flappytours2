let helpers={setFlex:element=>{document.getElementById(element).style.display="flex"},setBlock:element=>{document.getElementById(element).style.display="block"},hide:element=>{document.getElementById(element).style.display="none"},setCookie:(c_name,c_value,c_days)=>{let d=new Date;d.setTime(d.getTime()+24*c_days*60*60*1e3);let expires="expires="+d.toUTCString();document.cookie=c_name+"="+c_value+";"+expires+";path=/"},getCookie:c_name=>{let name=c_name+"=",decodedCookie,ca=decodeURIComponent(document.cookie).split(";");for(let i=0;i<ca.length;i++){let c=ca[i];for(;" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}};class ScrollingLayer{constructor(scene,y,speedX,overlapX,texture,frame){let t=this;t.scene=scene,t.y=y,t.speed=speedX,t.overlap=overlapX,t.texture=texture,t.frame=frame,t.init()}init(){let t=this;t.x=0,t.img1=t.scene.add.image(t.x,t.y,t.texture,t.frame),t.img2=t.scene.add.image(t.img1.width-t.overlap,t.y,t.texture,t.frame)}setOrigin(x=.5,y){null==y&&(y=x),this.img1.setOrigin(x,y),this.img2.setOrigin(x,y)}getDistance(speed,deltaTime){return deltaTime*speed/1e3}update(delta){let t=this;t.img1.x+=t.getDistance(t.speed,delta),t.img2.x+=t.getDistance(t.speed,delta),t.img1.x<-t.img1.width&&(t.img1.x=t.img1.width+t.img2.x-t.overlap),t.img2.x<-t.img2.width&&(t.img2.x=t.img1.width+t.img1.x-t.overlap)}}class LoadScreen extends Phaser.Scene{constructor(){super("loadScreen")}init(){let gbs={topScore:0,newRecord:!1,scorePreviousGame:0,key_atlas:"atl_juego"};this.gbs=gbs,this.registry.set("globals",gbs)}preload(){let t=this;t.load.on("complete",(function(){t.scene.start("menu")}),t),t.load.on("progress",this.updateLoad,this),t.load.audio("music","assets/sounds/music/PleasantCreekLoop.mp3"),t.load.audio("crash",["assets/sounds/suelo.wav","assets/sounds/suelo.mp3"]),t.load.audio("gameover",["assets/sounds/gameover.mp3","assets/sounds/gameover.wav"]),t.load.audio("flap",["assets/sounds/aleteo.wav","assets/sounds/aleteo.mp3"]),t.load.audio("point",["assets/sounds/punto.wav","assets/sounds/punto.mp3"]),t.load.atlas(t.gbs.key_atlas,"assets/imgs/lowres_ar133/flappy5.png","assets/imgs/lowres_ar133/flappy5.json")}updateLoad(progress){document.getElementById("p_carga").innerHTML=`${Math.round(100*progress)}%`}}class Menu extends Phaser.Scene{constructor(){super("menu")}init(){let t=this;t.gbs=this.registry.get("globals"),t.btplay=document.getElementById("btplay"),t.bthelp=document.getElementById("bthelp"),t.btcredits=document.getElementById("btcredits"),t.lycredits=document.getElementById("credits"),t.lyhelp=document.getElementById("help")}create(){let t=this;t.btplay.onclick=this.playButton.bind(t),t.bthelp.onclick=this.helpButton,t.btcredits.onclick=this.creditsButton,t.lycredits.onclick=this.closeCredits,t.lyhelp.onclick=this.closeHelp,this.add.image(0,0,t.gbs.key_atlas,"layer1").setOrigin(0,0);let ground=this.add.image(0,0,t.gbs.key_atlas,"layer3").setOrigin(0,0);ground.setY(this.game.config.height-ground.height),this.gbs.groundHeight=ground.height;let mountains=this.add.image(0,0,t.gbs.key_atlas,"layer2").setOrigin(0,0);mountains.setY(this.game.config.height-ground.height-mountains.height+10),this.gbs.mountainsHeight=mountains.height,this.gbs.topScore=helpers.getCookie("best")?parseInt(helpers.getCookie("best")):0,helpers.hide("loading"),document.getElementById("menu").style.display="flex"}playButton(){this.removeListeners(),helpers.hide("menu"),this.scene.start("inGame")}helpButton(){helpers.setFlex("help")}creditsButton(){helpers.setFlex("credits")}closeCredits(){helpers.hide("credits")}closeHelp(){helpers.hide("help")}removeListeners(){let t=this;t.btplay.removeEventListener("click",t.playButton),t.bthelp.removeEventListener("click",t.helpButton),t.btcredits.removeEventListener("click",t.creditsButton),t.lycredits.removeEventListener("click",t.closeCredits),t.lyhelp.removeEventListener("click",t.closeHelp)}}class InGame extends Phaser.Scene{constructor(){super("inGame")}init(){let t=this;t.gbs=t.registry.get("globals"),t.width=t.game.config.width,t.height=t.game.config.height,t.score=0,t.birdCollided=!1,t.birdHasScored=!1,t.birdImpulse=-350,t.pipeWidth=t.textures.getFrame(t.gbs.key_atlas,"tuberia").width,t.pipeSpeed=-180,t.pipeDistance=200,t.pairsOfPipes=2,t.posXNewPipe=(t.pairsOfPipes-1)*(t.pipeDistance+t.pipeWidth)+t.pipeDistance,t.pipesGap=Math.round(.409*t.height),t.groundHeight=t.textures.getFrame(t.gbs.key_atlas,"layer3").height,t.mountainsHeight=t.textures.getFrame(t.gbs.key_atlas,"layer2").height,t.mountainsSpeed=-10,t.groundSpeed=Math.round(1.06*t.pipeSpeed),t.scoreDOM=document.getElementById("score")}create(){let t=this;t.physics.world.bounds.height=t.game.config.height-68,t.music=t.sound.add("music",{volume:.4,loop:!0}),t.music.play(),t.music.on("stop",()=>{t.music.play()},t),t.crash=this.sound.add("crash",{volume:1}),t.snd_flap=this.sound.add("flap",{volume:1}),t.snd_gameover=this.sound.add("gameover",{volume:1}),t.snd_point=this.sound.add("point",{volume:1}),t.generateAnimations(),t.add.image(0,0,t.gbs.key_atlas,"layer1").setOrigin(0,0);let mountainsY=t.game.config.height-t.groundHeight-t.mountainsHeight+10;t.mountains=new ScrollingLayer(t,mountainsY,t.mountainsSpeed,2,t.gbs.key_atlas,"layer2"),t.mountains.setOrigin(0,0),t.pipes=t.generatePipes(),t.ground=new ScrollingLayer(t,t.height-t.groundHeight,t.groundSpeed,2,t.gbs.key_atlas,"layer3"),t.ground.setOrigin(0,0),t.bird=t.physics.add.sprite(100,t.height/2,t.gbs.key_atlas,"pato1"),t.bird.play("flapping"),t.bird.setGravityY(1200),t.bird.setCollideWorldBounds(!0,0,.3),t.physics.add.collider(t.bird,t.pipes,t.collision,null,t),t.input.on("pointerdown",t.flap,t),t.scoreDOM.innerHTML="0",document.getElementById("inGame").style.display="block";let timedEvent=t.time.addEvent({delay:1e3,callback:t.printFps,callbackScope:t,loop:!0})}printFps(){console.log(this.game.loop.actualFps)}update(time,delta){let t=this;t.bird.angle<20&&(t.bird.angle+=1),t.birdCollided||(t.mountains.update(delta),t.ground.update(delta)),t.checkPipes()}getDistance(pixelsSecond,deltaTime){return deltaTime*pixelsSecond/1e3}generateAnimations(){let key=this.gbs.key_atlas;this.anims.create({key:"flapping",frames:[{key:key,frame:"pato1"},{key:key,frame:"pato2"},{key:key,frame:"pato3"},{key:key,frame:"pato4"},{key:key,frame:"pato5"},{key:key,frame:"pato6"},{key:key,frame:"pato7"},{key:key,frame:"pato8"}],frameRate:10,repeat:-1})}generatePipes(){let t=this,group=t.physics.add.group({collideWorldBounds:!1,velocityX:t.pipeSpeed,gravityY:0});for(let i=0;i<t.pairsOfPipes;i++){let ceilingPipeY=-185*t.height/600+130*Math.random(),ceilingPipeX=t.width+50+i*(t.pipeWidth+t.pipeDistance),ceilingPipe=t.make.image({key:t.gbs.key_atlas,frame:"tuberia",x:ceilingPipeX,y:ceilingPipeY,flipY:!0},!0);ceilingPipe.isUpper=!0,group.add(ceilingPipe);let floorPipeY=ceilingPipe.getBottomCenter().y+t.pipesGap+ceilingPipe.height/2,floorPipeX=ceilingPipeX,floorPipe=t.make.image({key:t.gbs.key_atlas,frame:"tuberia",x:floorPipeX,y:floorPipeY},!0);floorPipe.isUpper=!1,group.add(floorPipe)}return group}flap(){let t=this;t.bird.setVelocityY(t.birdImpulse),t.bird.setAngle(-20),t.snd_flap.play()}checkPipes(){let t=this,ceilingPipeY,floorPipeY;t.pipes.getChildren().forEach((function(item){if(item.body.x<-t.pipeWidth){let gapFactor,newGap=(t.score<41?.4043-.004358*t.score:.21)*t.height;item.isUpper?(ceilingPipeY=Math.round(-175*t.height/600+Math.random()*(320*t.height/600)),item.body.reset(t.posXNewPipe,ceilingPipeY),ceilingPipeY=item.getBottomCenter().y):(floorPipeY=ceilingPipeY+item.height/2+newGap,item.body.reset(t.posXNewPipe,floorPipeY),t.birdHasScored=!1),item.body.setVelocityX(t.pipeSpeed)}else item.x<t.bird.x-item.width&&!t.birdHasScored&&(t.snd_point.play(),t.score++,t.scoreDOM.innerHTML=t.score,t.birdHasScored=!0)}))}collision(bird,pipe){let t=this;t.birdCollided||(t.birdCollided=!0,"vibrate"in window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(100),t.input.removeListener("pointerdown",t.flap,t),t.crash.play(),t.music.removeAllListeners("stop"),t.music.stop(),t.snd_gameover.play(),t.pipes.setVelocityX(0),bird.setAngularVelocity(-250),bird.setVelocityX(-30),bird.setCollideWorldBounds(!1),pipe.body.setVelocityX(0),pipe.body.setVelocityY(0),t.cameras.main.shake(200,.03),t.gbs.scorePreviousGame=this.score,this.checkRecord(),setTimeout(()=>{helpers.hide("inGame"),t.pipes.setVisible(!1),t.scene.pause(),t.scene.launch("gameOver")},3500))}checkRecord(){let t=this;t.score>t.gbs.topScore&&(helpers.setCookie("best",this.score,365),t.gbs.topScore=this.score,t.gbs.newRecord=!0)}}class GameOver extends Phaser.Scene{constructor(){super("gameOver")}init(){this.gbs=this.registry.get("globals")}create(){let t=this;helpers.setFlex("gameOver");let txt_score="";this.gbs.newRecord?(t.gbs.newRecord=!1,txt_score=t.gbs.topScore,document.getElementById("message").innerHTML="NEW RECORD !!!"):txt_score=t.gbs.scorePreviousGame,Number.isNaN(t.gbs.topScore)&&(t.gbs.topScore=0),document.getElementById("recuento").innerHTML=txt_score,document.getElementById("bestscore").innerHTML=t.gbs.topScore,t.input.on("pointerdown",()=>{helpers.hide("gameOver"),document.getElementById("message").innerHTML="",t.scene.stop("inGame"),t.scene.start("menu")})}}function runGame(width,height){var config={type:Phaser.CANVAS,width:width,height:height,parent:"gamediv",backgroundColor:0,scale:{mode:Phaser.Scale.HEIGHT_CONTROLS_WIDTH,autoCenter:Phaser.Scale.CENTER_BOTH,autoRound:!0},physics:{default:"arcade",arcade:{debug:!1}},scene:[LoadScreen,Menu,InGame,GameOver]};new Phaser.Game(config)}window.onload=function(){let gameWidth=362,gameHeight=480,box=document.getElementById("gamediv"),widthRatio=box.clientWidth/(362*box.clientHeight/480);if(document.styleSheets&&widthRatio<.84){let newHeight=480*box.clientWidth/304.08,newTop=(box.clientHeight-newHeight)/2;document.styleSheets[0].insertRule(`.fullscreen, .fullscreenflex {bottom: unset; top: ${newTop}px; height: ${newHeight}px;}`,40)}runGame(362,480)};